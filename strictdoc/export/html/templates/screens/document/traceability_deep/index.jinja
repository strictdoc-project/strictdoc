{% set template_type = 'Deep Traceability' %}

{% extends "base.jinja.html" %}

{% block head_css %}
  {{ super() }}
  <link rel="stylesheet" href="{{link_renderer.render_static_url('requirement-tree.css')}}"/>
{% endblock head_css %}

{% block head_scripts %}
  <script type="text/javascript" src="{{link_renderer.render_static_url('viewtype_menu.js')}}"></script>
  <script type="text/javascript" src="{{link_renderer.render_static_url('resizable_bar.js')}}"></script>

  {%- if config.is_running_on_server -%}
  <script type="module">
    import hotwiredTurbo from "{{link_renderer.render_static_url('turbo.js')}}";
    import { Application } from "{{link_renderer.render_static_url('stimulus.js')}}";
    window.Stimulus = Application.start();
  </script>
  <script type="module" src="{{link_renderer.render_static_url('controllers/collapsible_list_controller.js')}}"></script>
  <script type="module" src="{{link_renderer.render_static_url('controllers/modal_controller.js')}}"></script>
  {%- endif -%}

  {%- if config.enable_mathjax -%}
  <script id="MathJax-script" async src="{{link_renderer.render_static_url('mathjax/tex-mml-chtml.js')}}"></script>
  {%- endif -%}
  {# only for deep-trace: #}
  <script type="text/javascript" src="{{link_renderer.render_static_url('pan_with_space.js')}}"></script>
  {{ super() }}
{% endblock head_scripts %}
{% block title %}{{document.title}} - {{ template_type }}{% endblock %}
{% block viewtype %}deep_traceability{% endblock %}

{% block layout_nav %}
  {%- if not standalone -%}
  {% include "_shared/nav.jinja.html" %}
  {%- endif -%}
{% endblock layout_nav %}

{% block tree_content %}
  {% include "screens/document/_shared/resizable_bar_with_project_tree.jinja" %}
{% endblock %}

{% block toc_content %}
  {% include "screens/document/_shared/resizable_bar_with_toc.jinja" %}
{% endblock toc_content %}

{% block header_content %}
<div class="header">
  {% include "_shared/document_header.jinja.html" %}
</div>
{% endblock header_content %}

{% block content %}

    {% include "_shared/tags.jinja.html" %}

    {%- if document.has_any_requirements() -%}
      <div class="content">
      {%- for section_or_requirement in document_iterator.all_content() %}
        {%- if section_or_requirement.is_section and section_or_requirement.ng_has_requirements %}
          <section class="content_section">
            <div class="content_item" data-role="current">
              {%- set section = section_or_requirement %}
              {% include "components/section/tiny_extends_card.jinja" %}
            </div>
          </section>

        {%- elif section_or_requirement.is_requirement %}
        <section class="content_section">
          <div class="content_item" data-role="parents">
          {%- with requirement=section_or_requirement, requirement_partial="components/requirement/tiny_extends_card.jinja" -%}
            {% include "_shared/requirement_tree_left.jinja.html" %}
          {%- endwith -%}
          </div>

          {%- set requirement = section_or_requirement %}
          <div class="content_item" data-role="current">
            {% include "components/requirement/tiny_extends_card.jinja" %}
          </div>

          <div class="content_item" data-role="children">
          {%- with requirement=section_or_requirement, requirement_partial="components/requirement/tiny_extends_card.jinja" -%}
            {% include "_shared/requirement_tree_right.jinja.html" %}
          {%- endwith -%}
          </div>
        </section>
        {%- endif -%}
      {%- endfor -%}
      </div>
    {%- else -%}
      <sdoc-main-placeholder data-testid="document-main-placeholder">
        This view is empty because
        <br/>the document has no requirements.
      </sdoc-main-placeholder>
    {%- endif -%}

{% endblock content %}
{% block scripts %}
{% endblock %}
