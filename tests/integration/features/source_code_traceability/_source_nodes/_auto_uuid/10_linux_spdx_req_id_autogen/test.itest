#
# @relation(SDOC-SRS-141, scope=file)
#
RUN: cp -r %S/* %T/
RUN: cd %T/
RUN: %strictdoc --debug manage auto-uid %T | filecheck %s

CHECK: Reading source: src{{.}}example{{.}}example.c
CHECK: Total execution time

#
# The output requirements file only contains the change in two fields with
# nothing else affected.
# The regular expression is used to verify that the field is indeed SHA256.
#
RUN: %expect_exit 1 %diff %S/requirements.sdoc %T/requirements.sdoc | filecheck %s --check-prefix CHECK-DIFF
CHECK-DIFF:      < MID: TBD
CHECK-DIFF-NEXT: < HASH: TBD
CHECK-DIFF-NEXT: ---
CHECK-DIFF-NEXT: > MID: {{[a-f0-9]{64}}}
CHECK-DIFF-NEXT: > HASH: dee51cd1dc666a6d1b2678c27c2b6dfc85376107e403963a8afc83acb62ff944

#
# Source file with SPDX fields gets a stable hash generated.
#
RUN: cat %T/src/example/example.c | filecheck %s --check-prefix CHECK-SOURCE-FILE
CHECK-SOURCE-FILE: SPDX-Req-ID: {{[a-f0-9]{64}}}

#
# File without SPDX fields is not modified in any way.
#
RUN: %diff %S/src/example/example_no_spdx.c %T/src/example/example_no_spdx.c
