(()=>{"use strict";function e(e){let t={printUnits:"mm",printLeftMargin:"21",printRightMargin:"21",printTopMargin:"12",printBottomMargin:"12",printFontSize:"12pt",screenUnits:"px",headerMargin:"16",footerMargin:"16",virtualPagesGap:"16"};const n={printWidth:"210",printHeight:"297"},o={printWidth:"148.5",printHeight:"210"};switch(e.printPaperSize){case"A5":case"a5":t={...t,...o};break;default:t={...t,...n}}return t}const t={root:"[html2pdf]",footerTemplate:"[html2pdf-footer]",headerTemplate:"[html2pdf-header]",frontpageTemplate:"[html2pdf-frontpage]",frontpageContent:"html2pdf-frontpage",headerContent:"html2pdf-header",footerContent:"html2pdf-footer",pageNumberRoot:"[html2pdf-page-number]",pageNumberCurrent:"[html2pdf-page-number-current]",pageNumberTotal:"[html2pdf-page-number-total]",paperFlow:"html2pdf-paper-flow",contentFlow:"html2pdf-content-flow",virtualPaper:"html2pdf-virtual-paper",virtualPaperTopMargin:"html2pdf-virtual-paper-margin-top",virtualPaperBottomMargin:"html2pdf-virtual-paper-margin-bottom",virtualPaperGap:"html2pdf-virtual-paper-gap",paperBody:"html2pdf-paper-body",paperHeader:"html2pdf-paper-header",paperFooter:"html2pdf-paper-footer",runningSafety:"html2pdf-print-running",printPageBreak:"html2pdf-print-page-break",printIgnore:"[html2pdf-print-ignore]",printHide:"[html2pdf-print-hide]",neutral:"html2pdf-neutral",textNode:"html2pdf-text-node",complexTextBlock:"html2pdf-complex-text-block",printForcedPageBreak:"html2pdf-print-forced-page-break",flagNoBreak:"[html2pdf-flag-no-break]",flagNoHanging:"[html2pdf-flag-no-hanging]"};class n{constructor(e){this.config=e}create(){return this._baseStyle()+this._testStyle()}_baseStyle(){return`\n\n@page {\n  size: A4;\n  /* 2 values: width then height */\n  size: ${this.config.printWidth+this.config.printUnits} ${this.config.printHeight+this.config.printUnits};\n\n  margin-left: ${this.config.printLeftMargin-1+this.config.printUnits};\n  margin-right: ${this.config.printRightMargin-1+this.config.printUnits};\n  margin-top: ${this.config.printTopMargin-0+this.config.printUnits};\n  margin-bottom: ${this.config.printBottomMargin-2+this.config.printUnits};\n}\n\n${t.root} {\n  /* reset user styles */\n  display: block;\n\n  /* for proper printable flow positioning */\n  position: relative;\n\n  /* to compensate for possible BG in the parent node */\n  z-index: 1;\n\n  /* set print styles: affects previews */\n  margin: 0 auto;\n  width: ${this.config.printWidth-this.config.printLeftMargin-this.config.printRightMargin}${this.config.printUnits};\n  font-size: ${this.config.printFontSize};\n\n  /* protection against unpredictability of margins */\n  padding-top: .1px;\n  padding-bottom: ${2*this.config.virtualPagesGap+this.config.screenUnits};\n}\n\n${t.virtualPaper} {\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: minmax(min-content, max-content) minmax(min-content, max-content) 1fr minmax(min-content, max-content) minmax(min-content, max-content);\n  place-items: stretch stretch;\n  place-content: stretch stretch;\n  width: ${this.config.printWidth-this.config.printLeftMargin-this.config.printRightMargin}${this.config.printUnits};\n  height: ${this.config.printHeight}${this.config.printUnits};\n  font-size: ${this.config.printFontSize};\n}\n\n${t.virtualPaper}::before {\n  position: absolute;\n  content: '';\n  width: ${this.config.printWidth}${this.config.printUnits};\n  height: ${this.config.printHeight}${this.config.printUnits};\n  left: -${this.config.printLeftMargin}${this.config.printUnits};\n  background-color: #fff;\n  box-shadow: rgba(0, 0, 0, 0.1) 2px 2px 12px 0px;\n  z-index: -1;\n}\n\n${t.paperFooter},\n${t.paperHeader} {\n  display: block;\n  position: relative;\n}\n\n${t.headerContent},\n${t.footerContent} {\n  display: block;\n  font-size: small;\n}\n\n${t.headerContent} p,\n${t.footerContent} p {\n  margin: 0;\n}\n\n${t.headerContent} {\n  padding-bottom: ${this.config.headerMargin}${this.config.screenUnits};\n  /* padding-top: 1px; */\n  /* Page numbers: */\n  padding-top: 10px;\n}\n\n${t.footerContent} {\n  padding-top: ${this.config.footerMargin}${this.config.screenUnits};\n  /* padding-bottom: 1px; */\n  /* Page numbers: */\n  padding-bottom: 10px;\n}\n\n${t.pageNumberRoot} {\n  display: flex;\n  column-gap: 2px;\n  position: absolute;\n  /* left: 100%; */\n  right: 0;\n  text-align: right;\n  line-height: 1;\n}\n\n${t.headerContent} ${t.pageNumberRoot} {\n  top: 0;\n}\n\n${t.footerContent} ${t.pageNumberRoot} {\n  bottom: 0;\n}\n\n${t.pageNumberCurrent} {\n  font-weight: bold;\n}\n\n${t.paperFlow} {\n  display: block;\n  position: absolute;\n  width: 100%;\n  z-index: -1;\n  /* affect only screen */\n  padding-bottom: 100px;\n}\n\n${t.contentFlow} {\n  display: block;\n}\n\n${t.runningSafety} {\n  display: block;\n  /* firefox ignores 0.1px size, so it's necessary to make a full-size pixel\n     and take it into account in the calculations\n  */\n  padding-top: 1px;\n}\n\n${t.virtualPaperTopMargin} {\n  display: block;\n  height: ${this.config.printTopMargin}${this.config.printUnits};\n}\n\n${t.virtualPaperBottomMargin} {\n  display: block;\n  height: ${this.config.printBottomMargin}${this.config.printUnits};\n}\n\n${t.virtualPaperGap} {\n  display: block;\n  padding-top: ${this.config.virtualPagesGap}${this.config.screenUnits};\n}\n\n${t.paperBody} {\n  display: block;\n}\n\n${t.frontpageContent} {\n  display: block;\n  transform-origin: top center;\n  padding: .1px;\n  height: 100%;\n}\n\n${t.textNode},\n${t.neutral},\n${t.neutral} span {\n  display: inline;\n  padding: 0;\n  margin: 0;\n  font: inherit;\n  color: inherit;\n  line-height: inherit;\n  background: none;\n  background-color: transparent;\n}\n\n${t.complexTextBlock} {\n  display: block;\n}\n\n${t.printPageBreak} {\n  display: block;\n}\n\n${t.printForcedPageBreak} {\n  display: block;\n  visibility: hidden;\n  height: 0;\n  overflow: hidden;\n}\n\n@media print {\n  ${t.root} {\n    /* to prevent a blank last page */\n    padding: 0;\n  }\n\n  ${t.paperFlow} {\n    padding-bottom: 0;\n  }\n\n  ${t.contentFlow} {\n    -webkit-mask-image: none !important;\n            mask-image: none !important;\n  }\n\n  ${t.printIgnore},\n  ${t.virtualPaper} {\n    display: contents;\n  }\n\n  ${t.printHide},\n  ${t.virtualPaper}::before,\n  ${t.virtualPaperTopMargin},\n  ${t.virtualPaperBottomMargin},\n  ${t.virtualPaperGap} {\n    display: none;\n  }\n\n  ${t.printPageBreak} {\n    break-after: page;\n    padding: .1px;\n  }\n\n  ${t.printForcedPageBreak} {\n    /* JUST MANUAL! */\n    /* break-after: page; */\n  }\n\n  ${t.flagNoBreak} {\n    /*\n    TODO: temporary commented!\n    When splitting blocks, printPageBreak falls INTO this element,\n    and in Firefox it causes a blank page.\n    FIX the split of complex blocks and check in Firefox.\n    */\n    /* break-inside: avoid-page; */\n  }\n}\n    `}_testStyle(){return this.config.debugMode&&`\n/* FOR TEST */\n${t.virtualPaperGap} {\n  background: #ff000020;\n}\n\n${t.paperFooter},\n${t.paperHeader} {\n  background: #fa96ff20;\n}\n${t.paperBody} {\n  background: #ffee0020;\n}\n${t.runningSafety} {\n  background: #f200ff;\n}\n${t.frontpageContent} {\n  background: #00fcff20;\n}\n\n${t.neutral} {\n  background: #00ffee10;\n}\n\n${t.textNode} {\n  background: #00ff0010;\n}\n\n[filler] {\n  background:repeating-linear-gradient(\n    -45deg,\n    rgba(0, 175, 255, .1),\n    rgba(0, 175, 255, .1) 10px,\n    rgba(0, 175, 255, .15) 10px,\n    rgba(0, 175, 255, .15) 20px\n  );\n}\n    `}}class o{constructor({DOM:e,debugMode:t}){this.debugMode=t,this.DOM=e,this.body=e.body}insertStyle(e){const t=this.DOM.querySelector("head"),n=this.DOM.createElement("style");n.append(this.DOM.createTextNode(e)),n.setAttribute("data-printthis-inserted",""),t.append(n)}createDocumentFragment(){return this.DOM.createDocumentFragment()}getElement(e,t=this.DOM){return t.querySelector(e)}removeNode(e){e.remove()}cloneNode(e){return e?.cloneNode(!0)}cloneNodeWrapper(e){return e?.cloneNode(!1)}insertBefore(e,...t){e.before(...t)}insertAfter(e,...t){e.after(...t)}insertAtEnd(e,...t){e.append(...t)}insertAtStart(e,...t){e.prepend(...t)}insertInsteadOf(e,...t){e.before(...t),e.remove()}getRightNeighbor(e){return e.nextElementSibling}getLeftNeighbor(e){return e.previousElementSibling}getElementOffsetParent(e){return e.offsetParent}getDataId(e){return e.dataset.id}setAttribute(e,t){if(!e||!t)return void(console.warn&&console.warn("setAttribute() must have 2 params"));const n=t.charAt(0);if("."!==n)if("#"!==n)if("["!==n)this.debugMode&&console.log(`you're really sure ${t} is a selector?`);else{console.assert("]"===t.at(-1),`the ${t} selector is not OK.`);const n=t.substring(1,t.length-1);e.setAttribute(n,"")}else{const n=t.substring(1);e.id=n}else{const n=t.substring(1);e.classList.add(n)}}isSelectorMatching(e,t){if(!e||!t)return void(console.warn&&console.warn("isSelectorMatching() must have 2 params","\n element: ",e,"\n selector: ",t));const n=t.charAt(0);if("."===n){const n=t.substring(1);return e.classList.contains(n)}if("#"===n){const n=t.substring(1);return e.id===n}if("["===n){console.assert("]"===t.at(-1),`the ${t} selector is not OK.`);const n=t.substring(1,t.length-1);return e.hasAttribute(n)}return this.getElementTagName(e)===t.toUpperCase()}setFlagNoBreak(e){this.setAttribute(e,t.flagNoBreak)}setFlagNoHanging(e){this.setAttribute(e,t.flagNoHanging)}wrapTextNode(e){if(!this.isSignificantTextNode(e))return;const n=this.create(t.textNode);return e.before(n),n.append(e),n}isWrappedTextNode(e){return this.isSelectorMatching(e,t.textNode)}createNeutral(){return this.create(t.neutral)}createTestNodeFrom(e){const t=e.cloneNode(!1);return t.classList="test-node",t.style.position="absolute",t.style.background="rgb(255 239 177)",t.style.width=this.getMaxWidth(e)+"px",t}getMaxWidth(e){const t=this.create();e.append(t);const n=this.getElementWidth(t);return t.remove(),n}getLineHeight(e){const t=this.createNeutral();t.innerHTML="!",e.append(t);const n=t.offsetHeight;return t.remove(),n}getEmptyNodeHeight(e){const t=this.create();t.style.padding="0.1px";const n=e.cloneNode(!1);t.append(n),e.before(t);const o=t.offsetHeight;return t.remove(),o}getTableRowHeight(e,t=0){const n=e.offsetTop,o=e.cloneNode(!0),i="!<br />".repeat(t);[...o.children].forEach((e=>e.innerHTML=i)),e.before(o);const r=e.offsetTop;return o.remove(),r-n}createComplexTextBlock(){return this.create(t.complexTextBlock)}isComplexTextBlock(e){return this.isSelectorMatching(e,t.complexTextBlock)}getComputedStyle(e){return window.getComputedStyle(e)}isInline(e){const t=this.getComputedStyle(e).display;return"inline"===t||"inline-block"===t||"inline-table"===t||"inline-flex"===t||"inline-grid"===t}isInlineBlock(e){const t=this.getComputedStyle(e).display;return"inline-block"===t||"inline-table"===t||"inline-flex"===t||"inline-grid"===t}isGrid(e){return"grid"===this.getComputedStyle(e).display}isGridAutoFlowRow(e){const t=this.getComputedStyle(e).display,n=this.getComputedStyle(e).gridAutoFlow;return("grid"===t||"inline-grid"===t)&&"row"===n}isNeutral(e){return this.isSelectorMatching(e,t.neutral)}isForcedPageBreak(e){return this.isSelectorMatching(e,t.printForcedPageBreak)}insertForcedPageBreakBefore(e){const n=this.create(t.printForcedPageBreak);return this.insertBefore(e,n),n}findAllSelectorsInside(e,t){return"string"==typeof t&&(t=[t]),[...t].flatMap((t=>[...e.querySelectorAll(t)]))}isFirstChildOfFirstChild(e,t){if(!e||!e.parentElement)return!1;let n=e;for(;n.parentElement&&n!==t;){if(n.parentElement.firstElementChild!==n)return!1;n=n.parentElement}return n===t}findFirstChildParent(e,t){let n=e.parentElement,o=null;for(;n&&n!==t;)e===n.firstElementChild&&(o=n),n=(e=n).parentElement;return o}findLastChildParent(e,t){let n=e.parentElement,o=null;for(;n&&n!==t;)e===n.lastElementChild&&(o=n),n=(e=n).parentElement;return o}findAllForcedPageBreakInside(e){return[...e.querySelectorAll(t.printForcedPageBreak)]}isNoBreak(e){const n=this.isSelectorMatching(e,t.flagNoBreak);return n&&e.classList.add("ðŸ“›"),n}isNoHanging(e){return this.isSelectorMatching(e,t.flagNoHanging)}getElementTagName(e){return e.tagName}isDocumentBody(e){return"BODY"===e.tagName}isTextNode(e){return e.nodeType===Node.TEXT_NODE}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isSignificantTextNode(e){return!!this.isTextNode(e)&&e.nodeValue.trim().length>0}clearTemplates(e){e.querySelectorAll("template").forEach((e=>e.remove()))}getParentNode(e){return e.parentNode}getChildNodes(e){return e.childNodes}getChildren(e){return e.children}getInnerHTML(e){if("string"==typeof e){const t=this.DOM.querySelector(e);return t?t.innerHTML:void 0}return e.innerHTML}setInnerHTML(e,t){if("string"==typeof e){const n=this.DOM.querySelector(e);n&&(n.innerHTML=t)}e.innerHTML=t}setStyles(e,t){Object.entries(t).forEach((([t,n])=>e.style[t]=n))}create(e){if(!e)return this.DOM.createElement("div");const t=e.charAt(0);if("."===t){const t=e.substring(1),n=this.DOM.createElement("div");return n.classList.add(t),n}if("#"===t){const t=e.substring(1),n=this.DOM.createElement("div");return n.id=t,n}if("["===t){const t=e.substring(1,e.length-1),n=this.DOM.createElement("div");return n.setAttribute(t,""),n}return this.DOM.createElement(e)}createPrintPageBreak(){return this.create(t.printPageBreak)}createWithFlagNoBreak(e){const n=this.create(t.flagNoBreak);return e&&(n.style=e),n}wrapNode(e,t){e.before(t),t.append(e)}wrapNodeChildren(e){const t=this.getChildren(e),n=this.create();return this.insertAtStart(n,...t),this.insertAtStart(e,n),n}wrapWithFlagNoBreak(e){const t=this.createWithFlagNoBreak();return e.before(t),t.append(e),t}fitElementWithinBoundaries({element:e,height:t,width:n,vspace:o,hspace:i}){const r=o/t,s=i/n,l=r<s?r:s,a=Math.trunc(t*l),g=Math.trunc(n*l);e.style.height=a+"px",e.style.width=g+"px",e.setAttribute("height",`${a}px`),e.setAttribute("width",`${g}px`)}getElementBCR(e){return e.getBoundingClientRect()}getElementTop(e){return e?.offsetTop}getElementLeft(e){return e?.offsetLeft}getElementHeight(e){return e?.offsetHeight}getElementWidth(e){return e?.offsetWidth}getElementRelativeTop(e){return e?.offsetTop}getElementRootedTop(e,t,n=0){if(!e)return void(this.debugMode&&console.warn("element must be provided, but was received:",e,"\nThe function returned:",void 0));if(!t)return void(this.debugMode&&console.warn("root must be provided, but was received:",e,"\nThe function returned:",void 0));const o=e.offsetParent;if(!o)return void(this.debugMode&&console.warn("element has no offset parent",e,"\nThe function returned:",void 0));const i=e.offsetTop;return o===t?i+n:this.getElementRootedTop(o,t,n+i)}getElementRelativeBottom(e){return e?.offsetTop+e?.offsetHeight||void 0}getElementRootedBottom(e,t){return this.getElementRootedTop(e,t)+this.getElementHeight(e)}getElementRootedRealBottom(e,t){const n=this.create();e&&e.after(n);const o=e?this.getElementRootedTop(n,t):void 0;return n.remove(),o}getElementRootedRealTop(e,t){const n=parseInt(this.getComputedStyle(e).marginTop);return this.getElementRootedTop(e,t)-n}isLineChanged(e,t){return this.getElementRelativeTop(t)-this.getElementRelativeBottom(e)>-2}isLineKept(e,t){return this.getElementRelativeTop(t)-this.getElementRelativeBottom(e)<=-2}splitByWordsGreedy(e){return e.innerHTML.split(/(?<=\s|-)/)}splitByWordsGreedyWithSpacesFilter(e){return e.innerHTML.trim().split(/(?<=\s|-)/).filter((e=>" "!=e))}prepareSplittedNode(e){const t=e,n=this.splitByWordsGreedy(e),o=n.map((e=>{const t=this.DOM.createElement("span");return t.innerHTML=e+" ",t})),i=this.createTestNodeFrom(e);return i.append(...o),e.append(i),{splittedNode:t,nodeWords:n,nodeWordItems:o}}createSignpost(e,t=24){const n=this.create();return n.style.display="flex",n.style.flexWrap="nowrap",n.style.alignItems="center",n.style.justifyContent="center",n.style.textAlign="center",n.style.fontSize="8px",n.style.fontFamily="sans-serif",n.style.letterSpacing="1px",n.style.textTransform="uppercase",n.style.height=t+"px",e&&(n.innerHTML=e),n}createTable({wrapper:e,caption:t,thead:n,tfoot:o,tbody:i}){const r=e||this.create("table"),s=this.create("TBODY");return t&&r.append(t),n&&r.append(n),i&&s.append(...i),r.append(s),o&&r.append(o),r}getTableEntries(e){const t=[...e.children].reduce((function(e,t){const n=t.tagName;return"TBODY"===n?{...e,rows:[...e.rows,...t.children]}:"CAPTION"===n?{...e,caption:t}:"COLGROUP"===n?{...e,colgroup:t}:"THEAD"===n?{...e,thead:t}:"TFOOT"===n?{...e,tfoot:t}:"TR"===n?{...e,rows:[...e.rows,...t]}:{...e,unexpected:[...e.unexpected,...t]}}),{caption:null,thead:null,tfoot:null,rows:[],unexpected:[]});return t.unexpected.length>0&&this.debugMode&&console.warn(`something unexpected is found in the table ${e}`),t}lockTableWidths(e){this.copyNodeWidth(e,e),e.querySelectorAll("td").forEach((e=>this.copyNodeWidth(e,e)))}copyNodeWidth(e,t){e.style.width=this.getElementWidth(t)-1+"px"}findDeepestChild(e){let t=e;for(;t.firstElementChild;)t=t.firstElementChild;return t}}const i="border:1px solid #8888CC;background:#EEEEEE;color:#8888CC;";class r{constructor({config:e,DOM:t,selector:n}){this.debugMode=e.debugMode,this.DOM=t,this.selector=n,this.rootSelector=n?.root,this.paperFlowSelector=n?.paperFlow,this.contentFlowSelector=n?.contentFlow,this.printIgnoreElementSelector=n?.printIgnore,this.printHideElementSelector=n?.printHide,this.root=this._initRoot(),this.paperFlow=this._createPaperFlow(),this.contentFlow=this._createContentFlow()}create(){this.debugMode&&console.groupCollapsed("%c Layout ",i),this.DOM.setInnerHTML(this.root,""),this.DOM.insertAtEnd(this.root,this.paperFlow,this.contentFlow),this.root!==this.DOM.body&&this._ignorePrintingEnvironment(this.root),this.debugMode&&console.groupEnd("%c Layout ",i)}_initRoot(){let e=this.DOM.getElement(this.rootSelector);return this.debugMode&&console.log("%c Layout: init root ",i,e),e||(e=this.DOM.body,this.DOM.setAttribute(e,this.rootSelector),console.warn(`Add ${this.rootSelector} to the root element of the area you want to print. ${this.rootSelector} is now automatically added to the BODY tag.`)),e}_createPaperFlow(){return this.DOM.create(this.paperFlowSelector)}_createContentFlow(){const e=this.DOM.create(this.contentFlowSelector),t=this.DOM.getInnerHTML(this.root);return t.trim().length>0?(this.DOM.setInnerHTML(e,t),this.DOM.clearTemplates(e),this.DOM.insertAtEnd(e,this.DOM.create("[data-content-flow-end]"))):console.warn("It looks like you don't have any printable content."),e}_ignorePrintingEnvironment(e){let t=this.DOM.getParentNode(e);this.DOM.setAttribute(t,this.printIgnoreElementSelector),this.DOM.getChildNodes(t).forEach((t=>{if(t!==e&&this.DOM.isElementNode(t))this.DOM.setAttribute(t,this.printHideElementSelector);else{if(!this.DOM.isSignificantTextNode(t))return;this.DOM.setAttribute(this.DOM.wrapTextNode(t),this.printHideElementSelector)}})),this.DOM.isDocumentBody(t)||this._ignorePrintingEnvironment(t)}}const s="#66CC00",l=`color: ${s};font-weight:bold`,a=`border:1px solid ${s};background:#EEEEEE;color:${s};`;class g{constructor({config:e,DOM:t,layout:n,referenceWidth:o,referenceHeight:i}){this.debugMode=e.debugMode,this.debugToggler={_parseNode:!1,_parseNodes:!1,_getProcessedChildren:!1,_splitPreNode:!1,_splitTableNode:!1,_splitTableRow:!1,_splitGridNode:!1,_createSlicesBySplitFlag:!1,_getInternalSplitters:!1,_splitComplexTextBlockIntoLines:!1},this.noHangingSelector=this._prepareNoHangingSelector(e.noHangingSelector),this.forcedPageBreakSelector=this._prepareForcedPageBreakSelector(e.forcedPageBreakSelector),this.noBreakSelector=this._prepareNoBreakSelector(e.noBreakSelector),this.DOM=t,this.root=n.root,this.contentFlow=n.contentFlow,this.referenceWidth=o,this.referenceHeight=i,this.minLeftLines=2,this.minDanglingLines=2,this.minBreakableLines=this.minLeftLines+this.minDanglingLines,this.minLeftRows=2,this.minDanglingRows=2,this.minBreakableRows=this.minLeftRows+this.minDanglingRows,this.minPreFirstBlockLines=3,this.minPreLastBlockLines=3,this.minPreBreakableLines=this.minPreFirstBlockLines+this.minPreLastBlockLines,this.minBreakableGridRows=4,this.imageReductionRatio=.8,this.signpostHeight=24,this.pages=[],this.isFirefox="undefined"!=typeof InstallTrigger}calculate(){return this._prepareForcedPageBreakElements(),this._prepareNoBreakElements(),this._prepareNoHangingElements(),this._calculate(),this.debugMode&&console.log("%c âœ” Pages.calculate()",a,this.pages),this.pages}_prepareNoHangingElements(){this.noHangingSelector&&this.DOM.findAllSelectorsInside(this.contentFlow,this.noHangingSelector).forEach((e=>{this.DOM.setFlagNoHanging(e);const t=this.DOM.findLastChildParent(e,this.contentFlow);t&&this.DOM.setFlagNoHanging(t)}))}_prepareNoBreakElements(){this.noBreakSelector&&this.DOM.findAllSelectorsInside(this.contentFlow,this.noBreakSelector).forEach((e=>this.DOM.setFlagNoBreak(e)))}_prepareForcedPageBreakElements(){if(this.forcedPageBreakSelector){const e=this.DOM.findAllSelectorsInside(this.contentFlow,this.forcedPageBreakSelector);this.DOM.isFirstChildOfFirstChild(e[0],this.contentFlow)&&e.shift(),e.forEach((e=>this.DOM.insertForcedPageBreakBefore(e)))}}_calculate(){if(this.debugMode&&console.log("%c â–¼â–¼â–¼ Pages â–¼â–¼â–¼ ",a),this.debugMode&&console.groupCollapsed("â€¢â€¢ init data â€¢â€¢"),this.debugMode&&console.log("this.referenceHeight",this.referenceHeight,"\n","this.noHangingSelector",this.noHangingSelector,"\n","this.forcedPageBreakSelector",this.forcedPageBreakSelector,"\n","isFirefox",this.isFirefox),this.debugMode&&console.groupEnd("â€¢â€¢ init data â€¢â€¢"),this.DOM.getElementRootedRealBottom(this.contentFlow,this.root)<this.referenceHeight){const e=this.DOM.create("[data-content-flow-start]");return this.DOM.insertAtStart(this.contentFlow,e),this._registerPageStart(e),void this.DOM.findAllForcedPageBreakInside(this.contentFlow).forEach((e=>this._registerPageStart(e)))}const e=this._getChildren(this.contentFlow);this.debugMode&&console.groupCollapsed("%cðŸš¸ children(contentFlow)",a),this.debugMode&&console.log(e),this.debugMode&&console.groupEnd("%cðŸš¸ children(contentFlow)"),this._registerPageStart(e[0]),this._parseNodes({array:e})}_registerPageStart(e){this.pages.push({pageStart:e,pageBottom:this.DOM.getElementRootedRealTop(e,this.root)+this.referenceHeight})}_parseNodes({array:e,previous:t,next:n,parent:o,parentBottom:i}){this.debugMode&&this.debugToggler._parseNodes&&console.log("ðŸ”µ _parseNodes","\narray:",[...e],"\nretainedParent:",o);for(let r=0;r<e.length;r++)this._parseNode({i:r,previousElement:e[r-1]||t,currentElement:e[r],nextElement:e[r+1]||n,parent:o,parentBottom:r===e.length-1?i:void 0})}_parseNode({i:e,previousElement:t,currentElement:n,nextElement:o,parent:i,parentBottom:r}){const s=["%c_parseNode\n","color:white"];this.debugMode&&this.debugToggler._parseNode&&console.group("%c_parseNode",l,r?"â˜…lastâ˜…":""),this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"3 nodes: ",{previousElement:t,currentElement:n,nextElement:o});const a=0==e&&i?i:n;if(this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"parent:",i,"\n","parentBottom:",r,"\n","currentPageStart:",a,"\n"),!o)return void(this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"ðŸ THE END"));if(this.DOM.isForcedPageBreak(n))return this._registerPageStart(n),void(this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"ðŸš© FORCED BREAK"));this.debugMode&&console.assert(this.DOM.getElementOffsetParent(n),"it is expected that the element has an offset parent",n);const g=this.pages.at(-1).pageBottom,h=this.DOM.getElementRootedTop(o,this.root);if(this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"â€¢ newPageBottom",g,"\n","â€¢ nextElementTop",h),h<=g)this.DOM.findAllForcedPageBreakInside(n).forEach((e=>this._registerPageStart(e)));else{if(this._isNoHanging(n))return void this._registerPageStart(a);if(this._isSVG(n)||this._isIMG(n)){const e=this._isSVG(n)?this.DOM.wrapWithFlagNoBreak(n):n,t=g-this.DOM.getElementRootedTop(e,this.root),i=this.DOM.getElementHeight(e),r=this.DOM.getElementWidth(e);return i<this.referenceWidth&&this.debugMode&&this.debugToggler._parseNode&&console.warn("%c IMAGE is too wide","color: red"),i<t?void this._registerPageStart(o):t/i>this.imageReductionRatio?(this._registerPageStart(o),void this.DOM.fitElementWithinBoundaries({element:n,height:i,width:r,vspace:t,hspace:this.referenceWidth})):(this._registerPageStart(e),void(i>this.referenceHeight&&this.DOM.fitElementWithinBoundaries({element:n,height:i,width:r,vspace:this.referenceHeight,hspace:this.referenceWidth})))}const l=r||this.DOM.getElementRootedRealBottom(n,this.root);if(l<=g)return void this._registerPageStart(o);console.log("â“ _parseNode",n);const h=this._getProcessedChildren(n,g,this.referenceHeight),d=h.length;this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"childrenNumber ",d),this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"currentElement ",n);const p=d<=1||0==e?i||n:void 0;if(this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"set retainedParent",p),d){const e=this._isFullySPlitted(n);this._parseNodes({array:h,previous:t,next:o,parent:p,parentBottom:e?void 0:l})}else this._isNoHanging(t)?this._registerPageStart(t):(this._registerPageStart(a),this.debugMode&&this.debugToggler._parseNode&&console.log(...s,"_registerPageStart:",a))}this.debugMode&&this.debugToggler._parseNode&&console.groupEnd("%c_parseNode")}_isFullySPlitted(e){return this._isPRE(e)||this._isTableNode(e)||this.DOM.isGridAutoFlowRow(e)}_getProcessedChildren(e,t,n){const o=["%c_getProcessedChildren\n","color:white"];let i=[];return this._isNoBreak(e)?(this.debugMode&&this.debugToggler._getProcessedChildren&&console.info(...o,"ðŸ§¡ isNoBreak"),i=[]):this.DOM.isComplexTextBlock(e)?(this.debugMode&&this.debugToggler._getProcessedChildren&&console.info(...o,"ðŸ’š ComplexTextBlock"),i=this._splitComplexTextBlockIntoLines(e)||[],console.log("ðŸˆ¯_getProcessedChildren: Complex \n children AFTER _splitComplexTextBlockIntoLines: \n",[...i])):this._isTextNode(e)?(this.debugMode&&this.debugToggler._getProcessedChildren&&console.info(...o,"ðŸ’š TextNode"),i=this._splitComplexTextBlockIntoLines(e)||[],console.log("ðŸˆ³ _isTextNode ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³ðŸˆ³",[...i])):this._isPRE(e)?(this.debugMode&&this.debugToggler._getProcessedChildren&&console.info(...o,"ðŸ’š PRE"),i=this._splitPreNode(e,t,n)||[]):this._isTableNode(e)?(this.debugMode&&this.debugToggler._getProcessedChildren&&console.info(...o,"ðŸ’š TABLE"),i=this._splitTableNode(e,t,n)||[]):this.DOM.isGridAutoFlowRow(e)?(this.debugMode&&this.debugToggler._getProcessedChildren&&console.info(...o,"ðŸ’œ GRID"),i=this._splitGridNode(e,t,n)||[]):(i=this._getChildren(e),this.debugMode&&this.debugToggler._getProcessedChildren&&console.info(...o,"ðŸš¸ get element children ",i)),i}_processInlineChildren(e){let t=null;const n=[];return console.log("ðŸŸ  _processInlineChildren",e),e.forEach((e=>{this.DOM.isInline(e)?(t||(t=this.DOM.createComplexTextBlock(),this.DOM.wrapNode(e,t),n.push(t)),this.DOM.insertAtEnd(t,e)):(t=null,n.push(e))})),n}_splitComplexTextBlockIntoLines(e){if(e.classList.add(`s_${Math.random()}ðŸ’ `),this.DOM.isSelectorMatching(e,"[html2pdf-splitted]"))return this._getChildren(e);this.DOM.setAttribute(e,"[html2pdf-splitted]"),this.debugMode&&this.debugToggler._splitComplexTextBlockIntoLines&&console.group("_splitComplexTextBlockIntoLines"),this.debugMode&&this.debugToggler._splitComplexTextBlockIntoLines&&console.log("_splitComplexTextBlockIntoLines (node)",e),console.log("_splitComplexTextBlockIntoLines\n","ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸\n","ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸ã€°ï¸ NODE \n",e),e.setAttribute("_splitComplexTextBlockIntoLines","ðŸ›");const t=[...this.DOM.getChildren(e)];console.log("NODE Children:",t);const n=t.map((e=>{const t=this.DOM.getLineHeight(e);return{element:e,lines:~~(this.DOM.getElementHeight(e)/t),left:this.DOM.getElementLeft(e),top:this.DOM.getElementTop(e),lineHeight:t,text:e.innerHTML}})).flatMap((e=>e.lines>1&&!this._isNoBreak(e.element)?(e.element.classList.add("newComplexChildrenðŸ…±ï¸"),this._breakItIntoLines(e.element)):e.element)).reduce(((e,t,n,o)=>(t.setAttribute("currentIndex",n+"ðŸŸ¡"),!e.length||this.DOM.isLineChanged(e.at(-1).at(-1),t)?(e.push([t]),e):e.length&&this.DOM.isLineKept(e.at(-1).at(-1),t)?(e.at(-1).push(t),e):void(this.debugMode&&console.assert(!0,"newComplexChildrenGroups: An unexpected case of splitting a complex paragraph into lines.","\nOn the element:",t)))),[]);if(this.debugMode&&this.debugToggler._splitComplexTextBlockIntoLines&&console.log("ðŸŸ¡ðŸŸ¡ðŸŸ¡ newComplexChildrenGroups",n),n.length<this.minBreakableLines)return this.debugMode&&this.debugToggler._splitComplexTextBlockIntoLines&&console.log("newComplexChildrenGroups.length < this.minBreakableLines",n.length,"<",this.minBreakableLines),this.debugMode&&this.debugToggler._splitComplexTextBlockIntoLines&&console.groupEnd("_splitComplexTextBlockIntoLines"),[];console.log("ðŸŸ¡ðŸŸ¡ðŸŸ¡ newComplexChildrenGroups",n);const o=n.slice(0,this.minLeftLines).flat();console.log("â—€ï¸â—€ï¸â—€ï¸ firstUnbreakablePart",o);const i=n.slice(-this.minDanglingLines).flat();console.log("â–¶ï¸â–¶ï¸â–¶ï¸ lastUnbreakablePart",i),n.splice(0,this.minLeftLines,o),n.splice(-this.minDanglingLines,this.minDanglingLines,i),console.log("ðŸŸª newComplexChildrenGroups",n);const r=n.map(((e,t)=>{!t&&console.log("ðŸŸ£ðŸŸªðŸŸ£ðŸŸªðŸŸ£",t,e);const n=this.DOM.createWithFlagNoBreak();return e.length>1&&n.classList.add("groupðŸ›—"),n.setAttribute("role","groupã€°ï¸"),0==e.length?(n.setAttribute("role","ðŸš«"),console.assert(0==e.length,"The string cannot be empty (_splitComplexTextBlockIntoLines)")):1==e.length?n.setAttribute("role","line"):n.setAttribute("role","group"),n.dataset.index=t,this.DOM.insertBefore(e[0],n),this.DOM.insertAtEnd(n,...e),!t&&console.log("ðŸŸªðŸŸªðŸŸª",n,n.innerHTML),n}));return console.log("ðŸŸª linedChildren",r),this.debugMode&&this.debugToggler._splitComplexTextBlockIntoLines&&console.groupEnd("_splitComplexTextBlockIntoLines"),e.setAttribute("splitted","ðŸ’ "),r}_breakItIntoLines(e){if(this._isNoBreak(e))return e;const t=this.DOM.splitByWordsGreedyWithSpacesFilter(e),n=t.map(((e,t)=>{const n=this.DOM.create("html2pdf-word");return n.dataset.index=t,n.innerHTML=e+"",n}));e.innerHTML="",this.DOM.insertAtEnd(e,...n);const o=n.reduce(((e,t,o)=>(o>0&&n[o-1].offsetTop+n[o-1].offsetHeight<=t.offsetTop&&e.push(o),e)),[0]),i=o.reduce(((n,i,r)=>{const s=this.DOM.cloneNodeWrapper(e);s.classList.add("clonedðŸ…±ï¸");const l=o[r],a=o[r+1],g=" "+t.slice(l,a).join("")+" ";return this.DOM.setInnerHTML(s,g),this.DOM.insertBefore(e,s),r>0&&s.removeAttribute("id"),n.push(s),n}),[]);return e.remove(),i}_isVerticalFlowDisrupted(e){return e.some(((e,t,n)=>{const o=e,i=n[t+1];return!!i&&this.DOM.getElementRelativeBottom(o)>this.DOM.getElementRelativeTop(i)}))}_splitPreNode(e,t,n){const o=["%c_splitPreNode\n","color:white"];this.debugMode&&this.debugToggler._splitPreNode&&console.group("%c_splitPreNode","background:cyan"),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"node",e);const i=this.DOM.getElementRootedTop(e,this.root),r=this.DOM.getElementHeight(e),s=this.DOM.getLineHeight(e),l=this.DOM.getEmptyNodeHeight(e),a=(r-l)/s;if(a<this.minPreBreakableLines)return[];let g=this.DOM.getInnerHTML(e);"\n"===g.charAt(g.length-1)&&(this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"LAST CHAR IS \\n"),g=g.slice(0,-1)),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"1 - preText");const h=g.split("\n");if(this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"#### 2 - preLines",h),h.length<this.minPreBreakableLines)return this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"< minPreBreakableLines => return []"),[];let d=t-i-l;const p=n-l;this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"availableSpace: \n",`${d} = ${t} - ${i} - ${l}`);let c=Math.trunc(d/s);const u=Math.trunc(p/s);c<this.minPreFirstBlockLines&&(this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"availableSpace is too small \n (availableSpace = fullPageHeight)"),d=n,c=u);const b=a-c;this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"restLines:",b),Math.floor(b/u);const m=b%u;this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"lastPartLines:",m),m<this.minPreLastBlockLines&&(c-=this.minPreLastBlockLines-m,this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"firstPartLines:",c)),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"#### 3 - grouping lines");const f=h.reduce(((e,t,n,o)=>(""===t?e.push([]):e[e.length-1].push(t),e)),[[]]).filter((e=>e.length));this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"(3) raw preGroupedLines:",...f);let M="",T="";f[0].length<this.minPreFirstBlockLines&&(M=f.shift().join("\n")+"\n\n"),f[f.length-1].length<this.minPreLastBlockLines&&(T="\n"+f.pop().join("\n")),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"(3) split into groups of lines:"),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"veryStartGroup",M),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"preGroupedLines",f),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"veryEndGroup",T);const _=f.reduce(((e,t,n,i)=>{if(this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,`preBlocks block # ${n}`,t),t.length<this.minPreBreakableLines)e.push(t.join("\n")+"\n"),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"this block.length < this.minPreBreakableLines");else{const n=t.slice(0,this.minPreFirstBlockLines).join("\n")+"\n",o=t.slice(this.minPreFirstBlockLines,-this.minPreLastBlockLines).map((e=>e+"\n")),i=t.slice(-this.minPreLastBlockLines).join("\n")+"\n";e.push(n),o.length&&e.push(...o),e.push(i)}return e.push("\n"),e}),[]);if("\n"===_[_.length-1]&&_.pop(),M.length&&(_[0]=M+_[0]),T.length&&(_[_.length-1]=_[_.length-1]+T),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"#### 4 - preBlocks",_),1===_.length)return this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"DON'T SPLIT IT"),[];const S=_.map((e=>{const t=this.DOM.createNeutral();return this.DOM.setInnerHTML(t,e),t}));this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"blockAndLineElementsArray",S);const O=this.DOM.createTestNodeFrom(e);this.DOM.insertAtEnd(O,...S),this.DOM.insertAtEnd(e,O),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,`â€¢ availableSpace: ${d}`,"\n",`â€¢Â pageSpace: ${p}`);let D=0,E=[],N=d;this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"Find starts of parts splitters\n","â—† page: #",D,"\n","â—† floater:",N);for(let e=0;e<S.length;e++){const t=S[e],n=this.DOM.getElementRootedBottom(t,O);this.debugMode&&this.debugToggler._splitPreNode&&console.log("currentBottom:",n),this.DOM.getElementRootedBottom(t,O)>N&&(e&&E.push(e),e&&(D+=1),N=this.DOM.getElementRootedTop(t,O)+p,this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"â—† page: #",D,"\n","â—† new floater:",N))}if(O.remove(),E.push(null),this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"splitters",E),E.length<2)return[];const P=E.map(((t,n,o)=>{const i=this.DOM.cloneNodeWrapper(e);this.DOM.setFlagNoBreak(i);const r=o[n-1]||0,s=t||o[o.length];return this.DOM.insertAtEnd(i,...S.slice(r,s)),i}));return this.debugMode&&this.debugToggler._splitPreNode&&console.log(...o,"newPreElementsArray",P),this.DOM.setInnerHTML(e,""),this.DOM.insertAtEnd(e,...P),e.style.display="contents",e.setAttribute("slough-node",""),e.classList="",this.debugMode&&this.debugToggler._splitPreNode&&console.groupEnd("%c_splitPreNode","background:cyan"),P}_insertTableSplit({startId:e,endId:t,table:n,tableEntries:o}){const i=this.DOM.cloneNodeWrapper(n),r=o.rows.slice(e,t),s=this.DOM.createWithFlagNoBreak();return n.before(s),e&&this.DOM.insertAtEnd(s,this.DOM.createSignpost("(table continued)",this.signpostHeight)),this.DOM.insertAtEnd(s,this.DOM.createTable({wrapper:i,caption:this.DOM.cloneNode(o.caption),thead:this.DOM.cloneNode(o.thead),tbody:r}),this.DOM.createSignpost("(table continues on the next page)",this.signpostHeight)),s}_splitTableNode(e,t,n){this.DOM.lockTableWidths(e);const o=["%c_splitTableNode\n","color:white"];this.debugMode&&this.debugToggler._splitTableNode&&console.time("_splitTableNode"),this.debugMode&&this.debugToggler._splitTableNode&&console.group("%c_splitTableNode","background:cyan"),this.debugMode&&this.debugToggler._splitTableNode&&console.log(...o,"table",e);const i=this.DOM.getEmptyNodeHeight(e),r=this.DOM.getTableEntries(e);if(this.debugMode&&this.debugToggler._splitTableNode&&console.log(...o,"tableEntries",r),r.rows.length<this.minBreakableRows)return this.debugMode&&this.debugToggler._splitTableNode&&console.groupEnd("%c_splitTableNode","background:cyan"),[];const s=this.DOM.getElementRootedTop(e,this.root),l=(this.DOM.getElementHeight(e),this.DOM.getElementHeight(r.caption)||0),a=this.DOM.getElementHeight(r.thead)||0,g=this.DOM.getElementHeight(r.tfoot)||0,h=(l??0)*(this.isFirefox??0),d=t-s-this.signpostHeight-i,p=n-l-a-g-2*this.signpostHeight-i;this.debugMode&&this.debugToggler._splitTableNode&&console.log(...o,"pageBottom",t,"\n","- tableTop",s,"\n","- tableWrapperHeight",i,"\n","- this.signpostHeight",this.signpostHeight,"\n","= firstPartHeight",d),this.debugMode&&this.debugToggler._splitTableNode&&console.log(...o,"fullPageHeight",n,"\n","- tableCaptionHeight",l,"\n","- tableTheadHeight",a,"\n","- tableTfootHeight",g,"\n","- 2 * this.signpostHeight",2*this.signpostHeight,"\n","- tableWrapperHeight",i,"\n","= fullPagePartHeight",p);const c=e=>[...e.rows,e.tfoot||[]];let u=c(r),b=[],m=d;for(let n=0;n<u.length;n++){const o=u[n];if(this.DOM.getElementRootedTop(o,e)+h>m)if(0===n)m=p;else{const o=n-1,i=r.rows[o],s=this.DOM.getElementHeight(i),l=this.DOM.getTableRowHeight(i,this.minBreakableRows),a=this.DOM.getTableRowHeight(i),g=this.DOM.getElementRootedTop(i,e)+h,f=this.DOM.isNoBreak(i);if(s>=l&&!f){this.debugMode&&this.debugToggler._splitTableRow&&console.group("ðŸŸ£ðŸŸ£ðŸŸ£ Split The Row "+(n-1));const e=d-a-g,s=p-a,l=this.DOM.getChildren(i);let h;h=[...l].map((n=>{const o=this._getChildren(n);return this._getInternalSplitters({rootNode:n,children:o,pageBottom:t,firstPartHeight:e,fullPageHeight:s})})),this.debugMode&&this.debugToggler._splitTableRow&&console.log("ðŸŸ£ \ntheRowContentSlicesByTD",h);const b=h.some((e=>(this.debugMode&&this.debugToggler._splitTableRow&&console.log("ðŸŸ£","\nobj.result.length",e.result.length,"\nobj.result[0]",e.result[0]),e.result.length&&null===e.result[0])));this.debugMode&&this.debugToggler._splitTableRow&&console.log("ðŸŸ£","\nshouldFirstPartBeSkipped",b),b&&(h=[...l].map((e=>{const n=this._getChildren(e);return this._getInternalSplitters({rootNode:e,children:n,pageBottom:t,firstPartHeight:s,fullPageHeight:s})}))),this.debugMode&&this.debugToggler._splitTableRow&&console.log("ðŸŸ£","\n theRowContentSlicesByTD",h);const m=h.some((e=>e.result.length));if(this.debugMode&&this.debugToggler._splitTableRow&&console.log("ðŸŸ£ ifThereIsSplit",m),m){const e=h.map((e=>{if(e.result.length)return this._createSlicesBySplitFlag(e.trail);{const t=this.DOM.createWithFlagNoBreak();t.classList.add("ðŸŸ£"),t.display="contents";const n=e.trail.map((e=>e.element));return this.DOM.insertAtEnd(t,...n),[t]}}));this.debugMode&&this.debugToggler._splitTableRow&&console.log("ðŸŸ£ theTdContentElements",e);const t=Math.max(...e.map((e=>e.length)));this.debugMode&&this.debugToggler._splitTableRow&&console.log("ðŸŸ£ theNewTrCount",t);const s=[];for(let n=0;n<t;n++){const t=this.DOM.cloneNodeWrapper(i);this.DOM.setFlagNoBreak(t),[...l].forEach(((o,i)=>{const r=this.DOM.cloneNodeWrapper(o);e[i][n]&&this.DOM.insertAtEnd(r,e[i][n]),this.DOM.insertAtEnd(t,r)})),s.push(t)}this.debugMode&&this.debugToggler._splitTableRow&&console.log("ðŸŸ£","\n theNewRows",s),i.className="splittingRow",this.debugMode&&this.debugToggler._splitTableRow&&console.log("ðŸŸ£ splittingRow",i),this.DOM.insertInsteadOf(i,...s),r.rows.splice(o,1,...s),u=c(r),n-=1}this.debugMode&&this.debugToggler._splitTableRow&&console.groupEnd("ðŸŸ£ðŸŸ£ðŸŸ£ Split The Row "+(n-1))}else n>this.minLeftRows&&b.push(n-1),m=this.DOM.getElementRootedTop(u[n-1],e)+h+p}}if(this.debugMode&&this.debugToggler._splitTableNode&&console.log(...o,"splitsIds",b),!b.length)return this.debugMode&&this.debugToggler._splitTableNode&&console.groupEnd("%c_splitTableNode","background:cyan"),[];const f=u.length-1-this.minDanglingRows;b[b.length-1]>f&&(b[b.length-1]=f);const M=b.map(((t,n,o)=>this._insertTableSplit({startId:o[n-1]||0,endId:t,table:e,tableEntries:r})));this.debugMode&&this.debugToggler._splitTableNode&&console.log(...o,"splits",M);const T=this.DOM.createWithFlagNoBreak();return e.before(T),this.DOM.insertAtEnd(T,this.DOM.createSignpost("(table continued)",this.signpostHeight),e),this.debugMode&&this.debugToggler._splitTableNode&&console.timeEnd("_splitTableNode"),this.debugMode&&this.debugToggler._splitTableNode&&console.groupEnd("%c_splitTableNode","background:cyan"),[...M,T]}_createSlicesBySplitFlag(e){const t=this.DOM.createWithFlagNoBreak();t.classList.add("ðŸ§°"),t.display="contents";const n=[t];let o=[t],i=t;const r=e=>{if(0===e.length)return null;const t=e[0];let n=t;for(let t=1;t<e.length;t++){const o=e[t];this.DOM.insertAtEnd(n,o),n=o}return this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log(" createWrapperFromArray:",t),t},s=(e,t=null)=>{this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.group("processChildren"),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("*start* children",e);for(let t=0;t<e.length;t++)l(e[t]);this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("- wrappers BEFORE pop:",[...o]);const n=o.pop();this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("- wrappers.pop()",n),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("- parent",t),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("- wrappers AFTER pop:",[...o]),i=o.at(-1),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("ðŸŽ¯ðŸŽ¯ currentTargetInSlice",i),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("ðŸŽ¯ wrappers.at(-1)",o.at(-1)),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("*END* children",e),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.groupEnd("processChildren")},l=e=>{const t=e.children?.length>0,l=e.split,a=e.element,g=e.id;if(this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.group(`processObj # ${g}`),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("currentElement",a),a&&this.DOM.removeNode(a),l){this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢â€¢â€¢ hasSplitFlag"),o=o.map((e=>{const t=this.DOM.cloneNodeWrapper(e);return t.classList.add("ðŸš©"),t})),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢ hasSplitFlag: NEW wrappers.map:",[...o]);const e=r(o);n.push(e),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢ hasSplitFlag: slices.push(nextWrapper):",[...n]),i=o.at(-1),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢ hasSplitFlag: currentTargetInSlice:",i)}if(t){this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢â€¢â€¢ hasChildren");const t=this.DOM.cloneNodeWrapper(a);o.push(t),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢ hasChildren: wrappers.push(cloneCurrentElementWrapper)",t,[...o]),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢ hasChildren: currentTargetInSlice (check):",i),i?(this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢ hasChildren: currentTargetInSlice","TRUE, add to existing",t),this.DOM.insertAtEnd(i,t)):(this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢ hasChildren: currentTargetInSlice","FALSE, init the first",t),t.classList.add("ðŸfirst"),t.style.background="yellow",n.push(t),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢ hasChildren: slices.push(cloneCurrentElementWrapper)",t,[...n])),i=o.at(-1),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("â€¢ hasChildren:  currentTargetInSlice (=):",i),s(e.children,a)}else i=o.at(-1),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("insert currentElement",a,"to target",i),this.DOM.insertAtEnd(i,a);this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.groupEnd(`processObj # ${g}`)};return this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("#######  currentTargetInSlice (=):",i),s(e),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.log("slices:",n),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&n.forEach((e=>console.log("slice:",e))),this.debugMode&&this.debugToggler._createSlicesBySplitFlag&&console.groupEnd("%c_createSlicesBySplitFlag"),n}_getInternalSplitters({rootNode:e,children:t,pageBottom:n,firstPartHeight:o,fullPageHeight:i,result:r=[],trail:s=[],indexTracker:l=[],stack:a=[]}){this.debugMode&&this.debugToggler._getInternalSplitters&&console.group("ðŸ’Ÿ _getInternalSplitters");const g=e=>{e>=0?l.push(e):l.pop()},h=(e,t)=>{this.debugMode&&this.debugToggler._getInternalSplitters&&console.assert(t>=0,"registerResult: ID mast be provided",e);let n,o=s[t];if(this.debugMode&&this.debugToggler._getInternalSplitters&&console.groupCollapsed("ðŸ’œðŸ’œðŸ’œ registerResult(element, id)"),this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("\n element",e,"\n id",t,"\n theElementObject (trail[id])",o,"\n theElementIndexInStack",n),0==t){const e=(e=>{let t,n=null;for(let o=e.length-1;o>=0;o--){if(0!==e[o].id)return{item:n,index:t};n=e[o],t=o}return{item:n,index:t}})(a);this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸ’œðŸ’œ id == 0","\nðŸ’œ [...stack]",[...a],"\nðŸ’œ topParentElementFromStack",e),e.item&&(o=e.item,n=e.index)}this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸ’œ","\n theElementObject",o,"\n theElementIndexInStack",n,"\n [...indexTracker]",[...l]),0===n?(r.push(null),this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("result.push(null)","\n\nðŸ’œðŸ’œðŸ’œ")):(r.push(o.element),o&&(o.split=!0),this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("\n theElementObject",o,"\n theElementObject.element",o.element,"\n result.push(theElementObject.element)","\n\nðŸ’œðŸ’œðŸ’œ ")),this.debugMode&&this.debugToggler._getInternalSplitters&&console.groupEnd("ðŸ’œðŸ’œðŸ’œ registerResult(element, id)")};this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸ’Ÿ result ðŸ’Ÿ",r,"\n\n","\n rootNode:",e,"\n children:",t,"\n pageBottom:",n,"\n firstPartHeight:",o,"\n fullPageHeight:",i,"\n\n\n","ðŸ’Ÿ stack",[...a]);for(let d=0;d<t.length;d++){const p=t[d-1],c=t[d],u=t[d+1],b=u?this.DOM.getElementRootedTop(u,e):void 0,m={id:d,element:t[d]},f={id:d+1,element:t[d+1]};this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸ’Ÿ",d,"from",t.length-1,"ðŸ’Ÿ"),d!==(s.length?s.at(-1).id:void 0)&&s.push(m);const M=0===r.length?o:null===r.at(-1)?i:i+this.DOM.getElementRootedTop(r.at(-1),e);if(this.DOM.isForcedPageBreak(c)&&this.debugMode&&this.debugToggler._getInternalSplitters&&console.warn(c,"ðŸ’Ÿ is isForcedPageBreak"),b<=M)this._isNoHanging(c)&&(this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸ’ŸðŸ’Ÿ currentElement _isNoHanging"),h(c,d));else{this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸ’ŸðŸ’Ÿ nextElementTop > floater"),(this._isSVG(c)||this._isIMG(c))&&this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("%cIMAGE ðŸ’ŸðŸ’Ÿ","color:red;text-weight:bold");const t=this.DOM.getElementRootedRealBottom(c,e);if(this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸ’ŸðŸ’Ÿ current ???","\n currentElement",c,"\n currentElementBottom",t,"\n floater",M),t<=M)this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸ’ŸðŸ’ŸðŸ’Ÿ currentElementBottom <= floater"),u&&(this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸ’ŸðŸ’ŸðŸ’ŸðŸ’Ÿ register nextElement"),s.push(f),h(u,d+1)),this.debugMode&&this.debugToggler._getInternalSplitters&&console.groupEnd("ðŸ’Ÿ _getInternalSplitters");else{this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸ’ŸðŸ’ŸðŸ’Ÿ currentElementBottom > floater, \ntry to split",c),console.log("â“â“â“â“_getInternalSplittersâ“â“â“â“",c);const t=this._getProcessedChildren(c,n,i);t.length?(g(d),a.push(m),this._getInternalSplitters({rootNode:e,children:t,pageBottom:n,firstPartHeight:o,fullPageHeight:i,result:r,trail:s[d].children=[],indexTracker:l,stack:a}),a.pop(),this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("ðŸŸª back from _getInternalSplitters;\n trail[i]",s[d])):p&&this._isNoHanging(p)?(this.debugMode&&this.debugToggler._getInternalSplitters&&console.log("previousElement _isNoHanging"),h(p,d-1)):(this.debugMode&&this.debugToggler._getInternalSplitters&&console.log(c,"currentElement has no children"),h(c,d))}}}return g(),this.debugMode&&this.debugToggler._getInternalSplitters&&console.groupEnd("ðŸ’Ÿ _getInternalSplitters"),{result:r,trail:s}}_splitGridNode(e,t,n){const o=["%c_splitGridNode\n","color:white"];this.debugMode&&this.debugToggler._splitGridNode&&console.group("_splitGridNode");const i=this._getChildren(e);this.debugMode&&this.debugToggler._splitGridNode&&console.log(...o,"children",i);const r=i.reduce(((e,t,n,i)=>{const r=this.DOM.getComputedStyle(t),s=r.getPropertyValue("grid-column-start"),l=r.getPropertyValue("grid-column-end"),a={element:t,start:"auto"===s?"auto":parseInt(r.getPropertyValue("grid-column-start")),end:"auto"===l?"auto":parseInt(r.getPropertyValue("grid-column-end")),top:this.DOM.getElementTop(t)};return this.debugMode&&this.debugToggler._splitGridNode&&console.log(...o,"{ ???",t,e),!e.length||e.at(-1).at(-1).start>=a.start||"auto"===e.at(-1).at(-1).start||"auto"===a.start?(e.at(-1)&&this._isNoHanging(e.at(-1).at(-1).element)?(this.debugMode&&this.debugToggler._splitGridNode&&console.log("%cLAST","color:red"),e.at(-1).push(a)):e.push([a]),this.debugMode&&this.debugToggler._splitGridNode&&console.log(...o,"IF new:",a,[...e]),e):e.length&&e.at(-1).at(-1).start<a.start?(e.at(-1).push(a),this.debugMode&&this.debugToggler._splitGridNode&&console.log(...o,"IF new:",a,[...e]),e):void(this.debugMode&&console.assert(!0,"_splitGridNode: An unexpected case of splitting a grid.","\nOn the element:",t))}),[]);this.debugMode&&this.debugToggler._splitGridNode&&console.log(...o,"childrenGroups",r);const s=r.length,l=this.DOM.getElementHeight(e);if(s<this.minBreakableGridRows&&l<n)return[];const a=[...r.map((e=>e.map((e=>e.top)).sort())).map((e=>e[0])),l];this.debugMode&&this.debugToggler._splitGridNode&&console.log(...o,"topRowPoints",a);const g=this.DOM.getElementRootedTop(e,this.root),h=this.DOM.getEmptyNodeHeight(e),d=t-g-h,p=n-h;this.debugMode&&this.debugToggler._splitGridNode&&console.log("firstPartHeight",d),this.debugMode&&this.debugToggler._splitGridNode&&console.log("fullPagePartHeight",p);const c=a;let u=[],b=d;for(let e=0;e<c.length;e++)c[e]>b&&(e>this.minLeftRows&&u.push(e-1),b=c[e-1]+p);this.debugMode&&this.debugToggler._splitGridNode&&console.log("splitsIds",u);const m=(t,n)=>{this.debugMode&&this.debugToggler._splitGridNode&&console.log(...o,`=> insertGridSplit(${t}, ${n})`);const i=r.slice(t,n).flat().map((e=>e.element));this.debugMode&&this.debugToggler._splitGridNode&&console.log(...o,"partEntries",i);const s=this.DOM.cloneNodeWrapper(e);return this.DOM.copyNodeWidth(s,e),this.DOM.setFlagNoBreak(s),e.before(s),this.DOM.insertAtEnd(s,...i),s},f=u.map(((e,t,n)=>m(n[t-1]||0,e)));return this.debugMode&&this.debugToggler._splitGridNode&&console.log(...o,"splits",f),this.DOM.setFlagNoBreak(e),this.debugMode&&this.debugToggler._splitGridNode&&console.groupEnd("_splitGridNode"),[...f,e]}_splitTextNode(e,t,n){const o=this.DOM.getElementRootedTop(e,this.root),i=this.DOM.getElementHeight(e),r=this.DOM.getLineHeight(e),s=function({pageLines:e,nodeLines:t,firstPartLines:n,minBreakableLines:o,minLeftLines:i,minDanglingLines:r}){let s=[];if(t<o)return[];n<i&&(n=e),function o(i=0){const r=e*i+n,l=i?r-e*(i-1):n;if(t>r)return s=[...s,{endLine:r,splitter:r/t,partLines:l}],void o(i+1);const a=t-(r-e);s=[...s,{endLine:null,splitter:null,partLines:a}]}();const l=s.length-2,a=s.length-1;if(s[a].partLines<r){const e=r-s[a].partLines,n=s[l].endLine-e,o=n/t;s[l]={endLine:n,splitter:o,partLines:s[l].partLines-e},s[a].partLines=s[a].partLines+e}return s}({nodeLines:~~(i/r),pageLines:~~(n/r),firstPartLines:~~((t-o)/r),minBreakableLines:this.minBreakableLines,minLeftLines:this.minLeftLines,minDanglingLines:this.minDanglingLines});if(s.length<2)return[];const{splittedNode:l,nodeWords:a,nodeWordItems:g}=this.DOM.prepareSplittedNode(e),h=s.map((({endLine:e,splitter:t})=>t?function({arr:e,floater:t,topRef:n,getElementTop:o,root:i}){const r=(t,s)=>{const l=t+1,a=e[l],g=o(a,i);return s<g&&g>=n?l:r(l,g)},s=(t,r)=>{const l=t-1,a=e[l],g=o(a,i);return g<r&&r>=n?t:s(l,g)},l=~~(e.length*t),a=o(e[l],i);return a<n?r(l,a):s(l,a)}({arr:g,floater:t,topRef:e*r,getElementTop:this.DOM.getElementRelativeTop,root:this.root}):null)).map(((e,t,n)=>{const o=this.DOM.createWithFlagNoBreak(),i=n[t-1]||0,r=e||n[n.length];return this.DOM.setInnerHTML(o,a.slice(i,r).join("")+""),o}));return this.DOM.insertInsteadOf(l,...h),h}_getChildren(e){let t=[...this.DOM.getChildNodes(e)].reduce(((e,t)=>{if(this._isSTYLE(t))return e;if(this.DOM.isSignificantTextNode(t))return e.push(this.DOM.wrapTextNode(t)),e;if(!this.DOM.getElementOffsetParent(t)){const n=this._getChildren(t);return n.length>0&&e.push(...n),e}return this.DOM.isElementNode(t)?(e.push(t),e):void 0}),[]);return this._isVerticalFlowDisrupted(t)&&(t=this._processInlineChildren(t)),t}_isSignificantChild(e){const t=this.DOM.getElementTagName(e);return"A"!==t&&"TT"!==t&&this.DOM.getElementHeight(e)>0}_prepareNoHangingSelector(e){return["H1","H2","H3","H4","H5","H6",...e?.length?e?.split(/\s+/):[]]}_prepareForcedPageBreakSelector(e){return e?.length?e?.split(/\s+/):[]}_prepareNoBreakSelector(e){return e?.length?e?.split(/\s+/):[]}_isSTYLE(e){return"STYLE"===this.DOM.getElementTagName(e)}_isPRE(e){return"PRE"===this.DOM.getElementTagName(e)}_isIMG(e){return"IMG"===this.DOM.getElementTagName(e)}_isSVG(e){return"svg"===this.DOM.getElementTagName(e)}_isTextNode(e){return this.DOM.isWrappedTextNode(e)}_isTableNode(e){return"TABLE"===this.DOM.getElementTagName(e)}_isLiNode(e){return"LI"===this.DOM.getElementTagName(e)}_isNoBreak(e){return this.DOM.isNoBreak(e)||this.DOM.isInlineBlock(e)||this._notSolved(e)}_isNoHanging(e){return this.DOM.isNoHanging(e)}_notSolved(e){return"OBJECT"===this.DOM.getElementTagName(e)}}class h{constructor({config:e,DOM:t,selector:n}){this.debugMode=e.debugMode,this.DOM=t,this.selector=n,this.frontpageTemplateSelector=n?.frontpageTemplate,this.headerTemplateSelector=n?.headerTemplate,this.footerTemplateSelector=n?.footerTemplate,this.paperBodySelector=n?.paperBody||".paperBody",this.paperHeaderSelector=n?.paperHeader||".paperHeader",this.paperFooterSelector=n?.paperFooter||".paperFooter",this.headerContentSelector=n?.headerContent||".headerContent",this.footerContentSelector=n?.footerContent||".footerContent",this.frontpageContentSelector=n?.frontpageContent||".frontpageContent",this.virtualPaperSelector=n?.virtualPaper||".virtualPaper",this.virtualPaperTopMarginSelector=n?.virtualPaperTopMargin||".virtualPaperTopMargin",this.virtualPaperBottomMarginSelector=n?.virtualPaperBottomMargin||".virtualPaperBottomMargin",this.pageNumberRootSelector=n?.pageNumberRoot||void 0,this.pageNumberCurrentSelector=n?.pageNumberCurrent||void 0,this.pageNumberTotalSelector=n?.pageNumberTotal||void 0,this.frontpageTemplate=this.DOM.getInnerHTML(this.frontpageTemplateSelector),this.headerTemplate=this.DOM.getInnerHTML(this.headerTemplateSelector),this.footerTemplate=this.DOM.getInnerHTML(this.footerTemplateSelector),this.paperHeight,this.headerHeight,this.footerHeight,this.bodyHeight,this.bodyWidth,this.frontpageFactor,this._calculatePaperParams()}create({currentPage:e,totalPages:t}){const n=this._createPaperBody(this.bodyHeight),o=this._createPaperHeader(this.headerTemplate),i=this._createPaperFooter(this.footerTemplate);return this._createPaper({header:o,body:n,footer:i,currentPage:e,totalPages:t})}createFrontpage({currentPage:e,totalPages:t}){const n=this._createFrontpageContent(this.frontpageTemplate,this.frontpageFactor),o=this._createPaperBody(this.bodyHeight,n),i=this._createPaperHeader(this.headerTemplate),r=this._createPaperFooter(this.footerTemplate);return this._createPaper({header:i,body:o,footer:r,currentPage:e,totalPages:t})}createVirtualTopMargin(){return this.DOM.create(this.virtualPaperTopMarginSelector)}createVirtualBottomMargin(){return this.DOM.create(this.virtualPaperBottomMarginSelector)}_createPaper({header:e,body:t,footer:n,currentPage:o,totalPages:i}){const r=this.DOM.create(this.virtualPaperSelector);return this.DOM.insertAtEnd(r,this.createVirtualTopMargin(),e,t,n,this.createVirtualBottomMargin()),o&&i&&(this._setPageNumber(e,o,i),this._setPageNumber(n,o,i)),r}_createFrontpageContent(e,t){const n=this.DOM.create(this.frontpageContentSelector);return e&&this.DOM.setInnerHTML(n,e),t&&this.DOM.setStyles(n,{transform:`scale(${t})`}),n}_createPaperBody(e,t){const n=this.DOM.create(this.paperBodySelector);return this.DOM.setStyles(n,{height:e+"px"}),t&&this.DOM.insertAtEnd(n,t),n}_createPaperHeader(e){const t=this.DOM.create(this.paperHeaderSelector);if(e){const n=this.DOM.create(this.headerContentSelector);this.DOM.setInnerHTML(n,e),this.DOM.insertAtEnd(t,n)}return t}_createPaperFooter(e){const t=this.DOM.create(this.paperFooterSelector);if(e){const n=this.DOM.create(this.footerContentSelector);this.DOM.setInnerHTML(n,e),this.DOM.insertAtEnd(t,n)}return t}_setPageNumber(e,t,n){const o=this.pageNumberRootSelector?this.DOM.getElement(this.pageNumberRootSelector,e):this.pageNumberRootSelector;if(o){const e=this.DOM.getElement(this.pageNumberCurrentSelector,o),i=this.DOM.getElement(this.pageNumberTotalSelector,o);this.DOM.setInnerHTML(e,t),this.DOM.setInnerHTML(i,n)}}_calculatePaperParams(){const e=this._createPaperBody(),t=this._createFrontpageContent(this.frontpageTemplate),n=this._createPaperHeader(this.headerTemplate),o=this._createPaperFooter(this.footerTemplate),i=this._createPaper({header:n,body:e,footer:o}),r=this.DOM.create("#workbench");this.DOM.setStyles(r,{position:"absolute",left:"-3000px"}),this.DOM.insertAtEnd(r,i),this.DOM.insertAtStart(this.DOM.body,r);const s=this.DOM.getElementBCR(i).height,l=this.DOM.getElementHeight(n)||0,a=this.DOM.getElementHeight(o)||0,g=this.DOM.getElementHeight(e),h=this.DOM.getElementWidth(e);this.DOM.insertAtStart(e,t);const d=this.DOM.getElementHeight(e),p=d>g?g/d:1;this.DOM.removeNode(r),l>.2*s&&console.warn("It seems that your custom header is too high"),a>.15*s&&console.warn("It seems that your custom footer is too high"),p<1&&console.warn("It seems that your frontpage content is too large. We made it smaller to fit on the page. Check out how it looks! It might make sense to fix this with styles or reduce the text amount."),this.paperHeight=s,this.headerHeight=l,this.footerHeight=a,this.bodyHeight=g,this.bodyWidth=h,this.frontpageFactor=p}}const d="border:1px solid #ee00ee;background:#EEEEEE;color:#ee00ee;";class p{constructor({config:e,DOM:t,selector:n,pages:o,layout:i,paper:r}){this.config=e,this.debugMode=e.debugMode,this.DOM=t,this.selector=n,this.virtualPaperGapSelector=n?.virtualPaperGap,this.runningSafetySelector=n?.runningSafety,this.printPageBreakSelector=n?.printPageBreak,this.virtualPaper=n?.virtualPaper,this.virtualPaperTopMargin=n?.virtualPaperTopMargin,this.paperBody=n?.paperBody,this.pages=o,this.root=i.root,this.contentFlow=i.contentFlow,this.paperFlow=i.paperFlow,this.paper=r}create(){this.debugMode&&console.groupCollapsed("%c Preview ",d),this._processFirstPage(),this._processOtherPages(),this._addMask(),this.debugMode&&console.groupEnd("%c Preview ",d)}_addMask(){const e=[...this.paperFlow.querySelectorAll(this.virtualPaper)],t=this.DOM.getElementTop(e.at(-1))/(e.length-1),n=this.DOM.getElementHeight(this.paperFlow.querySelector(this.virtualPaperTopMargin)),o=this.DOM.getElementHeight(this.paperFlow.querySelector(this.paperBody));!function({targetElement:e,maskHeight:t,maskWindow:n,maskTopPosition:o}){e.style=`\n    -webkit-mask-image: linear-gradient(\n      black 0,\n      black ${n}px,\n      transparent ${n}px,\n      transparent ${t}px\n    );\n            mask-image: linear-gradient(\n              black 0,\n              black ${n}px,\n              transparent ${n}px,\n              transparent ${t}px\n            );\n    -webkit-mask-repeat: no-repeat;\n            mask-repeat: no-repeat;\n    -webkit-mask-size: 100% ${t}px;\n            mask-size: 100% ${t}px;\n    -webkit-mask-position: 100% ${o}px;\n            mask-position: 100% ${o}px;\n    -webkit-mask-repeat: repeat-y;\n            mask-repeat: repeat-y;\n    -webkit-mask-origin: border-box;\n            mask-origin: border-box;\n    `}({targetElement:this.contentFlow,maskHeight:t,maskWindow:o,maskTopPosition:n})}_processFirstPage(){let e;if(this.paper.frontpageTemplate){const t=this._insertFrontpageSpacer(this.contentFlow,this.paper.bodyHeight);this.pages.unshift({pageStart:t}),e=this.paper.createFrontpage({currentPage:1,totalPages:this.pages.length})}else e=this.paper.create({currentPage:1,totalPages:this.pages.length});this._insertIntoPaperFlow(e),this._insertIntoContentFlow(this.pages[0].pageStart)}_processOtherPages(){for(let e=1;e<this.pages.length;e++){const t=this.paper.create({currentPage:e+1,totalPages:this.pages.length}),n=this._createVirtualPaperGap();this._insertIntoPaperFlow(t,n),this._insertIntoContentFlow(this.pages[e].pageStart,n)}}_insertIntoPaperFlow(e,t){this._insertPaper(this.paperFlow,e,t)}_insertIntoContentFlow(e,t){t&&this._insertFooterSpacer(e,this.paper.footerHeight,t),this._insertHeaderSpacer(e,this.paper.headerHeight)}_insertPaper(e,t,n){n?this.DOM.insertAtEnd(e,n,t):this.DOM.insertAtEnd(e,t)}_createVirtualPaperGap(){return this.DOM.create(this.virtualPaperGapSelector)}_createVirtualPaperTopMargin(){return this.paper.createVirtualTopMargin()}_createVirtualPaperBottomMargin(){return this.paper.createVirtualBottomMargin()}_insertFrontpageSpacer(e,t){const n=this.DOM.create();return this.DOM.setStyles(n,{paddingBottom:t+"px"}),this.DOM.setAttribute(n,".printFrontpageSpacer"),this.DOM.insertAtStart(e,n),n}_insertHeaderSpacer(e,t){const n=this.DOM.create(this.runningSafetySelector);t&&this.DOM.setStyles(n,{marginBottom:t-1+"px"});const o=this.DOM.createDocumentFragment();this.DOM.insertAtEnd(o,this._createVirtualPaperTopMargin(),n),this.DOM.insertBefore(e,o)}_insertFooterSpacer(e,t,n){const o=this.DOM.create(this.runningSafetySelector);t&&this.DOM.setStyles(o,{marginTop:t-1+"px"});const i=this._createVirtualPaperGap(),r=this.DOM.createDocumentFragment();this.DOM.insertAtEnd(r,o,this._createVirtualPaperBottomMargin(),this.DOM.create(this.printPageBreakSelector),i),this.DOM.insertBefore(e,r);const s=this.DOM.getElementRootedTop(n,this.root)-this.DOM.getElementRootedTop(i,this.root);this.DOM.setStyles(o,{marginBottom:s+"px"}),this.debugMode&&console.log("%c balancer ",d,s)}}const c="border:1px dashed #cccccc;background:#ffffff;color:#cccccc;",u=document.currentScript.dataset,b=new class{constructor(e){this.params=e,this.config=this._config()}_config(){return{...e(this.params),...this.params}}render(){this.config.debugMode&&console.time("printTHIS");const e=new o({DOM:window.document,debugMode:this.config.debugMode});e.insertStyle(new n(this.config).create());const i=new r({config:this.config,DOM:e,selector:t}),s=new h({config:this.config,DOM:e,selector:t});i.create();const l=new g({config:this.config,DOM:e,layout:i,referenceHeight:s.bodyHeight,referenceWidth:s.bodyWidth}).calculate();new p({config:this.config,DOM:e,selector:t,layout:i,paper:s,pages:l}).create(),this.config.debugMode&&console.timeEnd("printTHIS")}}(u),m=new class{constructor(e){this.debugMode=e.debugMode,this.preloader,this.preloaderTarget=document.querySelector(e.preloaderTarget)||document.body,this.preloaderBackground=e.preloaderBackground||"white"}create(){this.debugMode&&console.groupCollapsed("%c Preloader ",c),this._insertStyle(),this.preloader=document.createElement("div"),this.preloader.classList.add("lds-dual-ring"),this.preloaderTarget.append(this.preloader),this.debugMode&&console.groupEnd("%c Preloader ",c)}remove(){if(!this.preloader)return;let e=1;const t=setInterval((()=>{e<=.1&&(clearInterval(t),this.preloader.remove()),this.preloader.style.opacity=e,e-=.1*e}),50);this.debugMode&&console.log("%c Preloader removed ",c)}_insertStyle(){const e=document.querySelector("head"),t=document.createElement("style");t.append(document.createTextNode(this._css())),t.setAttribute("data-preloader-style",""),e.append(t)}_css(){return`\n    /* PRELOADER */\n    .lds-dual-ring {\n      position: absolute;\n      z-index: 99999;\n      top: 0; left: 0; bottom: 0; right: 0;\n      background: ${this.preloaderBackground};\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    /*\n    .lds-dual-ring:after {\n      content: " ";\n      display: block;\n      width: 64px;\n      height: 64px;\n      margin: 8px;\n      border-radius: 50%;\n      border: 6px solid #eee;\n      border-color: #eee transparent #eee transparent;\n      animation: lds-dual-ring 1.2s linear infinite;\n    }\n    @keyframes lds-dual-ring {\n      0% {\n        transform: rotate(0deg);\n      }\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n    */\n  `}}(u);window.addEventListener("load",(function(e){b.render()})),"true"===u.preloader&&(window.addEventListener("DOMContentLoaded",(function(e){m.create()})),window.addEventListener("load",(function(e){m.remove()})))})();