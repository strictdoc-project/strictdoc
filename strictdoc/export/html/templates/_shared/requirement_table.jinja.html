<turbo-frame id="article-{{requirement.node_id}}">

{%- set anchor=link_renderer.render_local_anchor(requirement) -%}

<sdoc-node
  node-role="requirement"
  data-editable_node="on"
  data-testid="node-requirement-table"
  {%- if requirement.reserved_status %}
  data-status='{{ requirement.reserved_status.lower() }}'
  {%- endif %}
>

  {# {% include "_shared/requirement_block/h_title.jinja.html" %} #}
  <table class="requirement-table">


    {%- if requirement.reserved_title is not none %}
    <caption>
    {% include "_shared/requirement_block/anchor.jinja.html" %}
    <div class="requirement__title">
      {%- if requirement.context.title_number_string -%}
      {{ requirement.context.title_number_string }}.&nbsp;
      {%- endif -%}
      {{ requirement.reserved_title }}
      </div>
    </caption>
    {%- endif %}

    {# {% include "_shared/requirement_block/meta.jinja.html" %} #}
    {%- if requirement.has_meta -%}
    {% for meta_field in requirement.enumerate_meta_fields() %}
    <tr>
      <th>
        {{meta_field[0]}}:
      </th>
      <td>
        {{ meta_field[1] }}
      </td>
    </tr>
    {% endfor %}
    {%- endif %}

    {# {% include "_shared/requirement_block/related.jinja.html" %} #}
    {%- if traceability_index.has_parent_requirements(requirement) %}
    <tr>
      <th>
        parent&nbsp;refs:
      </th>
      <td>
        <ul class="requirement__link">
        {%- for requirement in traceability_index.get_parent_requirements(requirement) %}
        <li>
          <a class="requirement__link-parent" href="{{ link_renderer.render_requirement_link(requirement, document, document_type) }}">
            {%- if requirement.reserved_uid %}
            <span class="requirement__parent-uid">{{ requirement.reserved_uid }}</span>
            {%- endif %}
            {%- if requirement.reserved_title is not none %}
              {{ requirement.reserved_title }}
            {%- endif -%}
          </a>
        </li>
        {%- endfor %}
        </ul>
      </td>
    </tr>
    {%- endif %}

    {%- if traceability_index.has_children_requirements(requirement) %}
    <tr>
      <th>
        child&nbsp;refs:
      </th>
      <td>
        <ul class="requirement__link">
          {%- for requirement in traceability_index.get_children_requirements(requirement) %}
          <li>
            <a class="requirement__link-child" href="{{ link_renderer.render_requirement_link(requirement, document, document_type) }}">
              {%- if requirement.reserved_uid %}
              <span class="requirement__child-uid">{{ requirement.reserved_uid }}</span>
              {%- endif %}
              {%- if requirement.reserved_title is not none %}
              {{ requirement.reserved_title }}
              {%- endif %}
            </a>
          </li>
          {%- endfor %}
        </ul>
      </td>
    </tr>
    {%- endif %}

    {%- if requirement.has_requirement_references("BibRef") %}
    <tr>
      <th>
        external&nbsp;refs:
      </th>
      <td>
        <ul class="requirement__link">
          {%- for bib_ref in requirement.get_requirement_references("BibRef") %}
          <li>
            <span class="requirement__link-external">
              {{ bib_ref.bib_entry.ref_cite if bib_ref.bib_entry.ref_cite else "" }}
              {%- if bib_ref.bib_entry.ref_detail %}
                : {{ bib_ref.bib_entry.ref_detail }}
              {%- endif %}
            </span>
          </li>
          {%- endfor %}
        </ul>
      </td>
    </tr>
    {%- endif %}

    {# {% include "_shared/requirement_block/files_list.jinja.html" %} #}
    {%- if config.experimental_enable_file_traceability -%}
    {%- set requirement_file_links = traceability_index.get_requirement_file_links(requirement) %}
    {%- if requirement_file_links %}
    <tr>
      <th>
        file&nbsp;refs:
      </th>
      <td>
        <ul class="requirement__link">
          {%- for link, opt_ranges in requirement_file_links %}
            {%- if opt_ranges -%}
              {%- for range in opt_ranges %}
                <li>
                  <a class="requirement__link-file" href="{{ link_renderer.render_source_file_link(requirement, link) }}#{{ requirement.reserved_uid }}#{{ range.ng_range_line_begin }}#{{ range.ng_range_line_end }}">
                    {{ link.file_entry.file_path }}, <i>lines: {{ range.ng_range_line_begin }}-{{ range.ng_range_line_end }}</i>
                  </a>
                </li>
              {%- endfor -%}
            {%- else -%}
              <li>
                <a class="requirement__link-file" href="{{ link_renderer.render_source_file_link(requirement, link) }}#{{ requirement.reserved_uid }}">
                  {{ link.file_entry.file_path }}
                </a>
              </li>
            {%- endif -%}
          {%- endfor -%}
        </ul>
      </td>
    </tr>
    {%- endif %}
    {%- endif %}

    {# {% include "_shared/requirement_block/statement.jinja.html" %} #}
    {%- if requirement.reserved_statement -%}
    <tr>
      <th>
        Statement:
      </th>
      <td>
        {{ renderer.render_requirement_statement(requirement) }}
      </td>
    </tr>
    {%- endif -%}

    {# {% include "_shared/requirement_block/rationale.jinja.html" %} #}
    {%- if requirement.rationale -%}
    <tr>
      <th>
        Rationale:
      </th>
      <td>
        <div class="requirement__rationale">
          {{ renderer.render_requirement_rationale(requirement) }}
        </div>
      </td>
    </tr>
    {%- endif -%}

    {# {% include "_shared/requirement_block/comment.jinja.html" %} #}
    {%- if requirement.comments %}
    {%- for comment in requirement.comments %}
        <tr>
      <th>
        Comment:
      </th>
      <td>
          {{ renderer.render_comment(comment) }}
      </td>
    </tr>
    {%- endfor %}
    {%- endif %}

  </table>
  {%- if config.is_running_on_server -%}
  {% with
    node_controls__reference = requirement.node_id,
    node_controls__node_type = 'requirement'
  %}
    {% include "_shared/node_controls.jinja.html" %}
  {% endwith %}
  {%- endif -%}
</sdoc-node>
</turbo-frame>
